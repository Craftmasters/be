<?php
/**
 * RFP module file.
 *
 * @author
 *  Gerald Villorente
 */

/**
 * DOMPDF library.
 */
require_once 'dompdf/autoload.inc.php';
use Dompdf\Dompdf;
use Dompdf\Options;

/**
 * Implements hook_menu().
 */
function bullseye_rfp_menu() {
  $items = array();

  $items['rfps/add'] = array(
    'title' => 'Create New RFP',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('bullseye_rfp_form'),
    'access arguments' => array('add rfp'),
    'type' => MENU_NORMAL_ITEM,
  );

  $items['rfps/initial-add'] = array(
    'title' => 'Create New RFP',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('bullseye_rfp_initial_add_form'),
    'access arguments' => array('add rfp'),
    'type' => MENU_NORMAL_ITEM,
  );

  // Config Sesssion for BullsEye.
  $items['admin/config/bullseye'] = array(
    'title' => 'BullsEye Settings',
    'description' => 'Settings related to BullsEye',
    'weight' => -30,
    'page callback' => 'system_admin_menu_block_page',
    'access arguments' => array('access administration pages'),
    'file' => 'system.admin.inc',
    'file path' => drupal_get_path('module', 'system'),
    'position' => 'right',
  );

  // Derusni premium configuration page.
  $items['admin/config/bullseye/rfp'] = array(
    'title' => 'RFP Settings',
    'description' => 'RFP settings page.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('bullseye_rfp_admin_form'),
    'access arguments' => array('administer rfp settings'),
    'file' => 'bullseye_rfp.admin.inc',
    'file path' => drupal_get_path('module', 'bullseye_rfp'),
    'weight' => 5,
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Implements hook_permission().
 */
function bullseye_rfp_permission() {
  return array(
    'add rfp' => array(
      'title' => t('Create new RFP'),
      'description' => t('Allow user to add new rfp.'),
    ),
    'administer rfp settings' => array(
      'title' => t('Administer RFP'),
      'description' => t('Allow user to manage RFP settings.'),
    ),
  );
}

/**
 * Implements hook_form().
 *
 * Add RFP form (initial form popup).
 */
function bullseye_rfp_initial_add_form($form, &$form_state) {

  $form = array();

  $form['#attributes']['class'][] = 'be-forms be-forms-custom';

  $form['form_title'] = array(
    '#prefix' => '<div class="form-title">',
    '#suffix' => '</div>',
    '#markup' => '<h2>' . t('Create New RFP') . '</h2>',
  );

  $form['account'] = array(
    '#required' => FALSE,
    '#type' => 'entityreference',
    '#title' => t('Select Account'),
    '#era_entity_type' => 'node',
    '#era_bundles' => array('accounts'),
    '#era_cardinality' => 1,
    '#era_query_settings' => array(
      'limit' => 15, // Default is 50.
      'property_conditions' => array(
        array('status', 1, '='),
      ),
      'field_conditions' => array(),
    ),
  );

  $form['benefits_container'] = array(
    '#type' => 'container',
    'benefits' => array(),
  );

  $form['benefits_container']['benefits']['major_medical'] = array(
    '#type' => 'checkbox',
    '#title' => t('Major Medical'),
  );

  $form['benefits_container']['benefits']['limited_medical'] = array(
    '#type' => 'checkbox',
    '#title' => t('Limited Medical'),
  );

  $form['benefits_container']['benefits']['teledoc'] = array(
    '#type' => 'checkbox',
    '#title' => t('Telemedicine'),
  );

  $form['benefits_container']['benefits']['mec'] = array(
    '#type' => 'checkbox',
    '#title' => t('MEC'),
  );

  $form['benefits_container']['benefits']['life'] = array(
    '#type' => 'checkbox',
    '#title' => t('Life & AD&D'),
  );

  $form['benefits_container']['benefits']['short_term_disability'] = array(
    '#type' => 'checkbox',
    '#title' => t('Short Term Disability'),
  );

  $form['benefits_container']['benefits']['dental'] = array(
    '#type' => 'checkbox',
    '#title' => t('Dental'),
  );

  $form['benefits_container']['benefits']['vision'] = array(
    '#type' => 'checkbox',
    '#title' => t('Vision'),
  );

  $form['benefits_container']['benefits']['retirement'] = array(
    '#type' => 'checkbox',
    '#title' => t('Retirement'),
  );

  $form['benefits_container']['benefits']['special_benefits'] = array(
    '#type' => 'checkbox',
    '#title' => t('Special Benefits'),
  );

  $form['special_benefits_text'] = array(
    '#type' => 'textfield',
    '#attributes' => array(
      'placeholder' => t('Enter special benefit'),
    ),
  );

  $form['submit_container'] = array(
    '#type' => 'container',
  );

  $form['submit_container']['cancel'] = array(
    '#markup' => '<a class="gray-btn" href="/" onClick="parent.Lightbox.end();">Cancel</a>',
  );

  $form['submit_container']['submit'] = array(
    '#type' => 'submit',
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
    '#value' => t('Next'),
  );

  return $form;
}

/**
 * Form submit for initial create RFP Form.
 */
function bullseye_rfp_initial_add_form_submit($form, &$form_state) {
  // Clear session first.
  unset($_SESSION['add_rfp']);

  $account = node_load($form_state['values']['account']['entity_id']);
  $query = '/rfps/add?';
  $query .= 'account_name=' . $account->field_company[LANGUAGE_NONE][0]['value'];

  // Save the data temporarily to session variable.
  $_SESSION['add_rfp'] = array(
    'account_id' => $form_state['values']['account']['entity_id'],
    'major_medical' => $form_state['values']['major_medical'],
    'limited_medical' => $form_state['values']['limited_medical'],
    'teledoc' => $form_state['values']['teledoc'],
    'mec' => $form_state['values']['mec'],
    'life' => $form_state['values']['life'],
    'short_term_disability' => $form_state['values']['short_term_disability'],
    'dental' => $form_state['values']['dental'],
    'vision' => $form_state['values']['vision'],
    'retirement' => $form_state['values']['retirement'],
    'special_benefits' => $form_state['values']['special_benefits'],
    'special_benefits_text' => $form_state['values']['special_benefits_text'],
  );

  $benefits = array();

  // Prepare benefits data before passing to url parameter.
  foreach ($form_state['complete form']['benefits_container']['benefits'] as $key => $value) {
    if ($key[0] != '#') {
      $benefits[$key] = $value['#value'];
    }
  }

  // Build the parameter query for benefits array.
  $benefits_query = http_build_query(array('benefits' => $benefits));
  $query .= '&' . $benefits_query;

  // Close the lightbox and redirect to the next create new RFP page.
  print '<script>parent.location = "' . $query . '";</script>';
  print '<script>parent.Lightbox.end();</script>';
  die();
}

/**
 * Implements hook_form().
 *
 * Add RFP form.
 */
function bullseye_rfp_form($form, &$form_state) {

  $form = array();

  $form['#attributes']['class'][] = 'be-forms be-forms-custom';

  // Fringe Rate/s.
  $form['fringe_rates'] = array(
    '#type' => 'textfield',
    '#title' => t('Fringe Rate/s'),
    '#attributes' => array(
      'placeholder' => '500',
    ),
  );

  // Proposed Effective Date.
  $form['proposed_effective_date'] = array(
    '#type' => 'date_popup',
    '#date_format' => 'm/d/Y',
    '#default_value' => 'YYYY-MM-DD',
    '#date_year_range' => '0:+3',
    '#title' => t('Proposed Effective Date'),
  );

  // Other Work Locations and Zip Codes.
  $form['other_work_locations'] = array(
    '#type' => 'textfield',
    '#title' => t('Other Work Locations and Zip Codes'),
    '#attributes' => array(
      'placeholder' => 'Dallas 88829, New Jersey 81920',
    ),
  );

  // Number of Employees.
  $form['number_of_employees'] = array(
    '#type' => 'textfield',
    '#title' => t('Number of Employees'),
    '#attributes' => array(
      'placeholder' => '100',
    ),
  );

  // Number of Dependents.
  $form['number_of_dependents'] = array(
    '#type' => 'textfield',
    '#title' => t('Number of Dependents'),
    '#attributes' => array(
      'placeholder' => '200',
    ),
  );

  // Nature of Business/SIC.
  $form['nature_of_business'] = array(
    '#type' => 'textfield',
    '#title' => t('Nature of Business/SIC'),
    '#attributes' => array(
      'placeholder' => 'xxxx',
    ),
  );

  // Years in Business.
  $form['years_in_business'] = array(
    '#type' => 'textfield',
    '#title' => t('Years in Business'),
    '#attributes' => array(
      'placeholder' => '5',
    ),
  );

  // Tax ID.
  $form['tax_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Tax ID'),
    '#attributes' => array(
      'placeholder' => 'xxxxxxxxx',
    ),
  );

  // Renewal Date.
  $form['renewal_date'] = array(
    '#type' => 'date_popup',
    '#date_format' => 'm/d/Y',
    '#default_value' => 'YYYY-MM-DD',
    '#date_year_range' => '0:+3',
    '#title' => t('Renewal Date'),
  );

  // Attachments.
  $form['attachments_container'] = array(
    '#type' => 'container',
    'attachment' => array(),
  );

  $form['attachments_container']['attachment']['employee_census'] = array(
    '#title' => t('Employee Census'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['current_summary_of_benefit'] = array(
    '#title' => t('Current Summary of Benefit'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['current_bill'] = array(
    '#title' => t('Current Bill'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['last_renewal_letter'] = array(
    '#title' => t('Last Renewal Letter & Rates'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['summary_of_monthly_claims_experience'] = array(
    '#title' => t('Summary of Monthly Claims Experience'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['broker_of_record'] = array(
    '#title' => t('Broker of Record'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['letter_of_authorization'] = array(
    '#title' => t('Letter of Authorization'),
    '#type' => 'managed_file',
  );

  $form['attachments_container']['attachment']['large_claims_report'] = array(
    '#title' => t('Large Claims Report'),
    '#type' => 'managed_file',
  );

  // Census checkboxes.
  $form['census_container'] = array(
    '#type' => 'container',
    'census' => array(),
  );

  $form['census_container']['census']['check_identifier'] = array(
    '#type' => 'checkbox',
    '#title' => t('Identifier (Name or Employee Number)'),
  );

  $form['census_container']['census']['check_ssn'] = array(
    '#type' => 'checkbox',
    '#title' => t('Social Security Number'),
  );

  $form['census_container']['census']['check_date_birth_age'] = array(
    '#type' => 'checkbox',
    '#title' => t('Date of Birth or Age'),
  );

  $form['census_container']['census']['check_gender'] = array(
    '#type' => 'checkbox',
    '#title' => t('Gender'),
  );

  $form['census_container']['census']['check_home_zip_codes'] = array(
    '#type' => 'checkbox',
    '#title' => t('Home Zip Codes for each employee'),
  );

  $form['census_container']['census']['check_plan_selection'] = array(
    '#type' => 'checkbox',
    '#title' => t('Plan Selection (HMO, PPO, HSA, etc.)'),
  );

  $form['census_container']['census']['check_tier_levels'] = array(
    '#type' => 'checkbox',
    '#title' => t('Tier Levels (EE, ES, EC(H), EF) or 3 Tiers (if applicable)'),
  );

  $form['census_container']['census']['check_identification_of_retirees'] = array(
    '#type' => 'checkbox',
    '#title' => t('Identification of Retirees or COBRA members with COBRA Termination Date'),
  );

  $form['census_container']['census']['check_identification_of_covered'] = array(
    '#type' => 'checkbox',
    '#title' => t('Identification of covered and not covered employees with explanation for those not (i.e. spousal, medicare, medicaid, etc.)'),
  );

  $form['carrier_name'] = array(
    '#type' => 'textfield',
    '#title' => t('Carier Name'),
  );

  $form['primary_contact_name'] = array(
    '#type' => 'textfield',
    '#title' => t('Primary Contact'),
  );

  $form['primary_contact_email'] = array(
    '#type' => 'textfield',
    '#title' => t('Email Address'),
  );

  $form['major_medical'] = array(
    '#type' => 'checkbox',
    '#title' => t('Major Medical'),
    '#default_value' => $_GET['benefits']['major_medical'],
  );

  $form['limited_medical'] = array(
    '#type' => 'checkbox',
    '#title' => t('Limited Medical'),
    '#default_value' => $_GET['benefits']['limited_medical'],
  );

  $form['teledoc'] = array(
    '#type' => 'checkbox',
    '#title' => t('Teledoc'),
    '#default_value' => $_GET['benefits']['teledoc'],
  );

  $form['mec'] = array(
    '#type' => 'checkbox',
    '#title' => t('MEC'),
    '#default_value' => $_GET['benefits']['mec'],
  );

  $form['dental'] = array(
    '#type' => 'checkbox',
    '#title' => t('Dental'),
    '#default_value' => $_GET['benefits']['dental'],
  );

  $form['vision'] = array(
    '#type' => 'checkbox',
    '#title' => t('Vision'),
    '#default_value' => $_GET['benefits']['vision'],
  );

  $form['life'] = array(
    '#type' => 'checkbox',
    '#title' => t('Life & AD&D'),
    '#default_value' => $_GET['benefits']['life'],
  );

  $form['short_term_disability'] = array(
    '#type' => 'checkbox',
    '#title' => t('Short Term Dissability'),
    '#default_value' => $_GET['benefits']['short_term_disability'],
  );

  $form['special_benefits'] = array(
    '#type' => 'checkbox',
    '#title' => t('Special Benefits'),
    '#default_value' => $_GET['benefits']['special_benefits'],
  );

  $form['retirement'] = array(
    '#type' => 'checkbox',
    '#title' => t('Retirement'),
    '#default_value' => $_GET['benefits']['retirement'],
  );

  // Major Medical.
  $form['major_medical_fields'] = array(
    '#type' => 'container',
    'mm_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'mm_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'mm_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'mm_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'mm_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'mm_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'mm_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'mm_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'major_medical_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'major_medical_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'major_medical_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'major_medical_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'major_medical_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'major_medical_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'major_medical_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'major_medical_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Limited Medical.
  $form['limited_medical_fields'] = array(
    '#type' => 'container',
    'lm_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'lm_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'lm_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'lm_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'lm_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'lm_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'lm_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'lm_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'limited_medical_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'limited_medical_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'limited_medical_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'limited_medical_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'limited_medical_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'limited_medical_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'limited_medical_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'limited_medical_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Telemedicine.
  $form['teledoc_fields'] = array(
    '#type' => 'container',
    'tel_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'tel_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'tel_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'tel_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'tel_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'tel_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'tel_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'tel_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'teledoc_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'teledoc_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'teledoc_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'teledoc_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'teledoc_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'teledoc_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'teledoc_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'teledoc_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // MEC.
  $form['mec_fields'] = array(
    '#type' => 'container',
    'mec_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'mec_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'mec_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'mec_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'mec_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'mec_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'mec_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'mec_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'mec_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'mec_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'mec_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'mec_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'mec_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'mec_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'mec_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'mec_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Dental.
  $form['dental_fields'] = array(
    '#type' => 'container',
    'den_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'den_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'den_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'den_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'den_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'den_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'den_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'den_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'dental_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'dental_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'dental_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'dental_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'dental_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'dental_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'dental_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'dental_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Vision.
  $form['vision_fields'] = array(
    '#type' => 'container',
    'vs_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'vs_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'vs_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'vs_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'vs_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'vs_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'vs_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'vs_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'vision_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'vision_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'vision_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'vision_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'vision_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'vision_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'vision_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'vision_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Life.
  $form['life_fields'] = array(
    '#type' => 'container',
    'lf_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'lf_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'lf_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'lf_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'lf_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'lf_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'lf_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'lf_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'life_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'life_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'life_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'life_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'life_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'life_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'life_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'life_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Short Term Disability.
  $form['short_term_disability_fields'] = array(
    '#type' => 'container',
      'std_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'std_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'std_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'std_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'std_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'std_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'std_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'std_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'short_term_disability_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'short_term_disability_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'short_term_disability_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'short_term_disability_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'short_term_disability_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'short_term_disability_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'short_term_disability_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'short_term_disability_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Retirement.
  $form['retirement_fields'] = array(
    '#type' => 'container',
    'ret_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'ret_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'ret_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'ret_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'ret_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'ret_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'ret_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'ret_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'retirement_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'retirement_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'retirement_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'retirement_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'retirement_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'retirement_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'retirement_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'retirement_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Special Benefits.
  $form['special_benefits_fields'] = array(
    '#type' => 'container',
    'sb_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Carrier Name'),
      ),
    ),
    'sb_years_with_current_carrier' => array(
      '#type' => 'textfield',
      '#title' => t('Years with Current Carrier'),
      '#attributes' => array(
        'placeholder' => t('Type Number of Years'),
      ),
    ),
    'sb_plan_year_to_quote_start' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'sb_plan_year_to_quote_end' => array(
      '#type' => 'date_popup',
      '#date_format' => 'm/d/Y',
      '#default_value' => 'YYYY-MM-DD 00:00:00',
      '#date_year_range' => '0:+3',
    ),
    'sb_renewal_of_current_plan' => array(
      '#type' => 'radios',
      '#title' => t('Is this a renewal of a current plan in BullsEye?'),
      '#options' => array(
        1 => 'Yes',
        0 => 'No',
      ),
      '#default_value' => 1,
    ),
    'sb_percentage_single' => array(
      '#type' => 'textfield',
      '#title' => t('Single'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'sb_percentage_family' => array(
      '#type' => 'textfield',
      '#title' => t('Family'),
      '#attributes' => array(
        'placeholder' => t('50%'),
      ),
    ),
    'sb_waiting_period' => array(
      '#type' => 'textfield',
      '#title' => t('Wating Period for New Employees?'),
      '#attributes' => array(
        'placeholder' => t('15 Days'),
      ),
    ),
    'special_benefits_attach_ec' => array(
      '#type' => 'checkbox',
      '#title' => t('Employee Census'),
    ),
    'special_benefits_attach_csob' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Summary of Benefit'),
    ),
    'special_benefits_attach_cb' => array(
      '#type' => 'checkbox',
      '#title' => t('Current Bill'),
    ),
    'special_benefits_attach_lrlr' => array(
      '#type' => 'checkbox',
      '#title' => t('Last Renewal Letter & Rates'),
    ),
    'special_benefits_attach_somce' => array(
      '#type' => 'checkbox',
      '#title' => t('Summary of Monthly Claims Experience'),
    ),
    'special_benefits_attach_bor' => array(
      '#type' => 'checkbox',
      '#title' => t('Broker of Record'),
    ),
    'special_benefits_attach_loa' => array(
      '#type' => 'checkbox',
      '#title' => t('Letter of Authorization'),
    ),
    'special_benefits_attach_lcr' => array(
      '#type' => 'checkbox',
      '#title' => t('Large Claims Report'),
    ),
  );

  // Submit buttons for Benefit Generate RFPs.
  $form['generate_rfp_major_medical'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_major_medical'),
    '#name' => 'generate_rfp_major_medical',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_limited_medical'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_limited_medical'),
    '#name' => 'generate_rfp_limited_medical',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_teledoc'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_teledoc'),
    '#name' => 'generate_rfp_teledoc',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_mec'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_mec'),
    '#name' => 'generate_rfp_mec',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_dental'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_dental'),
    '#name' => 'generate_rfp_dental',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_vision'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_vision'),
    '#name' => 'generate_rfp_vision',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_life'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_life'),
    '#name' => 'generate_rfp_life',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_short_term_disability'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_short_term_disability'),
    '#name' => 'generate_rfp_short_term_disability',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_retirement'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_retirement'),
    '#name' => 'generate_rfp_retirement',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  $form['generate_rfp_special_benefits'] = array(
    '#type' => 'submit',
    '#submit' => array('generate_rfp_special_benefits'),
    '#name' => 'generate_rfp_special_benefits',
    '#value' => t('Send Email'),
    '#attributes' => array(
      'class' => array('green-btn'),
    ),
  );

  // The values for the dropdown box.
  $form['type_options'] = array(
    '#type' => 'value',
    '#value' => array(
      'high' => t('High'),
      'normal' => t('Normal'),
      'low' => t('Low'),
    ),
  );

  $form['priority'] = array(
    '#title' => t('Priority'),
    '#type' => 'select',
    '#description' => "Select the priority level.",
    '#options' => $form['type_options']['#value'],
  );

  $form['due_date'] = array(
    '#type' => 'date_popup',
    '#date_format' => 'm/d/Y',
    '#default_value' => 'YYYY-MM-DD 00:00:00',
    '#date_year_range' => '0:+3',
    '#size' => 12,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Save and Exit'),
  );

  return $form;
}

/**
 * Form submit for carrier form.
 */
function bullseye_rfp_form_submit($form, &$form_state) {

  global $user;

  $data = $_SESSION['add_rfp'];
  $account = node_load($data['account_id']);
  $form_state['values'] = $value;

  $be = new Bullseye($user);

  // Plan specifications.
  $fringe_rate = $value['fringe_rates'];
  $proposed_effective_date = $value['proposed_effective_date'];
  $other_work_locations = $value['other_work_locations'];
  $number_of_employees = $value['number_of_employees'];
  $number_of_dependents = $value['number_of_dependents'];
  $nature_of_business = $value['nature_of_business'];
  $years_in_business = $value['years_in_business'];
  $tax_id = $value['tax_id'];
  $renewal_date = $value['renewal_date'];

  // Attachments.
  $employee_census = $value['employee_census'];
  $current_summary_of_benefit = $value['current_summary_of_benefit'];
  $current_bill = $value['current_bill'];
  $last_renewal_letter = $value['last_renewal_letter'];
  $summary_of_monthly_claims_experience = $value['summary_of_monthly_claims_experience'];
  $broker_of_record = $value['broker_of_record'];
  $letter_of_authorization = $value['letter_of_authorization'];
  $large_claims_report = $value['large_claims_report'];

  // Census inclusions.
  $check_identifier = $value['check_identifier'];
  $check_ssn = $value['check_ssn'];
  $check_date_birth_age = $value['check_date_birth_age'];
  $check_gender = $value['check_gender'];
  $check_home_zip_codes = $value['check_home_zip_codes'];
  $check_plan_selection = $value['check_plan_selection'];
  $check_tier_levels = $value['check_tier_levels'];
  $check_identification_of_retirees = $value['check_identification_of_retirees'];
  $check_identification_of_covered = $value['check_identification_of_covered'];

  // Benefits.
  // MEC.
  $mec_current_carrier = $value['mec_current_carrier'];
  $mec_years_with_current_carrier = $value['mec_years_with_current_carrier'];
  $mec_plan_year_to_quote_start = $value['mec_plan_year_to_quote_start'];
  $mec_plan_year_to_quote_end = $value['mec_plan_year_to_quote_end'];
  $mec_renewal_of_current_plan = $value['mec_renewal_of_current_plan'];
  $mec_percentage_single = $value['mec_percentage_single'];
  $mec_percentage_family = $value['mec_percentage_family'];
  $mec_waiting_period = $value['mec_waiting_period'];
  // Dental.
  $den_current_carrier = $form_state['values']['den_current_carrier'];
  $den_years_with_current_carrier = $form_state['values']['den_years_with_current_carrier'];
  $den_plan_year_to_quote_start = $form_state['values']['den_plan_year_to_quote_start'];
  $den_plan_year_to_quote_end = $form_state['values']['den_plan_year_to_quote_end'];
  $den_renewal_of_current_plan = $form_state['values']['den_renewal_of_current_plan'];
  $den_percentage_single = $form_state['values']['den_percentage_single'];
  $den_percentage_family = $form_state['values']['den_percentage_family'];
  $den_waiting_period = $form_state['values']['den_waiting_period'];
  // Vision.
  $vs_current_carrier = $form_state['values']['vs_current_carrier'];
  $vs_years_with_current_carrier = $form_state['values']['vs_years_with_current_carrier'];
  $vs_plan_year_to_quote_start = $form_state['values']['vs_plan_year_to_quote_start'];
  $vs_plan_year_to_quote_end = $form_state['values']['vs_plan_year_to_quote_end'];
  $vs_renewal_of_current_plan = $form_state['values']['vs_renewal_of_current_plan'];
  $vs_percentage_single = $form_state['values']['vs_percentage_single'];
  $vs_percentage_family = $form_state['values']['vs_percentage_family'];
  $vs_waiting_period = $form_state['values']['vs_waiting_period'];
  // Life.
  $lf_current_carrier = $form_state['values']['lf_current_carrier'];
  $lf_years_with_current_carrier = $form_state['values']['lf_years_with_current_carrier'];
  $lf_plan_year_to_quote_start = $form_state['values']['lf_plan_year_to_quote_start'];
  $lf_plan_year_to_quote_end = $form_state['values']['lf_plan_year_to_quote_end'];
  $lf_renewal_of_current_plan = $form_state['values']['lf_renewal_of_current_plan'];
  $lf_percentage_single = $form_state['values']['lf_percentage_single'];
  $lf_percentage_family = $form_state['values']['lf_percentage_family'];
  $lf_waiting_period = $form_state['values']['lf_waiting_period'];
  // Short term disability.
  $std_current_carrier = $form_state['values']['std_current_carrier'];
  $std_years_with_current_carrier = $form_state['values']['std_years_with_current_carrier'];
  $std_plan_year_to_quote_start = $form_state['values']['std_plan_year_to_quote_start'];
  $std_plan_year_to_quote_end = $form_state['values']['std_plan_year_to_quote_end'];
  $std_renewal_of_current_plan = $form_state['values']['std_renewal_of_current_plan'];
  $std_percentage_single = $form_state['values']['std_percentage_single'];
  $std_percentage_family = $form_state['values']['std_percentage_family'];
  $std_waiting_period = $form_state['values']['std_waiting_period'];
  // Retirement.
  $ret_current_carrier = $form_state['values']['ret_current_carrier'];
  $ret_years_with_current_carrier = $form_state['values']['ret_years_with_current_carrier'];
  $ret_plan_year_to_quote_start = $form_state['values']['ret_plan_year_to_quote_start'];
  $ret_plan_year_to_quote_end = $form_state['values']['ret_plan_year_to_quote_end'];
  $ret_renewal_of_current_plan = $form_state['values']['ret_renewal_of_current_plan'];
  $ret_percentage_single = $form_state['values']['ret_percentage_single'];
  $ret_percentage_family = $form_state['values']['ret_percentage_family'];
  $ret_waiting_period = $form_state['values']['ret_waiting_period'];
  // Special Benefits.
  $sb_current_carrier = $form_state['values']['sb_current_carrier'];
  $sb_years_with_current_carrier = $form_state['values']['sb_years_with_current_carrier'];
  $sb_plan_year_to_quote_start = $form_state['values']['sb_plan_year_to_quote_start'];
  $sb_plan_year_to_quote_end = $form_state['values']['sb_plan_year_to_quote_end'];
  $sb_renewal_of_current_plan = $form_state['values']['sb_renewal_of_current_plan'];
  $sb_percentage_single = $form_state['values']['sb_percentage_single'];
  $sb_percentage_family = $form_state['values']['sb_percentage_family'];
  $sb_waiting_period = $form_state['values']['sb_waiting_period'];

  $node = new stdClass();

  $node->title = 'RFP' . $be->randChars(6);

  $node->type = "rfp";
  node_object_prepare($node);
  $node->language = LANGUAGE_NONE;
  $node->uid = $user->uid;
  $node->status = 1;
  $node->promote = 0;
  $node->comment = 0;

  // Cons vars.
  $lang = $node->language;
  $val = 'value';

  /***************
   * Group Info
   ***************/
  // Company.
  $node->field_company[$lang][0][$val] = $account->field_company[$lang][0][$val];
  // Primary email.
  $node->field_email[$lang][0][$val] = $account->field_email[$lang][0][$val];
  // Phone number.
  $node->field_phone_number[$lang][0][$val] = $account->field_phone_number[$lang][0][$val];
  // Website.
  $node->field_website[$lang][0][$val] = $account->field_website[$lang][0][$val];
  // Company Street Address.
  $node->field_company_street_address[$lang][0][$val] = $account->field_company_street_address[$lang][0][$val];
  // City.
  $node->field_city[$lang][0][$val] = $account->field_city[$lang][0][$val];
  // State.
  $node->field_frp_state[$lang][0][$val] = $account->field_frp_state[$lang][0][$val];
  // Zip Code.
  $node->field_zip_code[$lang][0][$val] = $account->field_zip_code[$lang][0][$val];

  /**************
   * Plan Specifications
   **************/
  // Fringe Rate.
  $node->field_fringe_rate[$lang][0][$val] = $value['fringe_rates'];
  // Proposed Effective Date.
  $ped = 'field_proposed_effective_date';
  $node->$ped[$lang][0][$val] = $value['proposed_effective_date'];
  // Other Work Locations and Zip Codes.
  $owl = 'field_other_work_locations';
  $node->$owl[$lang][0][$val] = $value['other_work_locations'];
  // Number of Employees.
  $noe = 'field_number_of_employees';
  $node->$noe[$lang][0][$val] = $value['number_of_employees'];
  // Number of Dependents.
  $nod = 'field_number_of_dependents';
  $node->$nod[$lang][0][$val] = $value['number_of_dependents'];
  // Nature of Business/SIC.
  $nbs = 'field_nature_of_business_sic';
  $node->$nbs[$lang][0][$val] = $value['nature_of_business'];
  // Years in Business.
  $yib = 'field_years_in_business';
  $node->$yib[$lang][0][$val] = $value['years_in_business'];
  // Tax ID.
  $node->field_tax_id[$lang][0][$val] = $value['tax_id'];
  // Renewal Date.
  $node->field_renewal_date[$lang][0][$val] = $value['renewal_date'];

  /*************
   * Benefits
   *************/
  // Major Medical.
  // Current carrier.
  $mcc = 'field_mm_current_carrier';
  $node->$mcc[$lang][0][$val] = $value['mm_current_carrier'];
  // Years with current carrier.
  $mycc = 'field_mm_years_current_carrier';
  $node->$mycc[$lang][0][$val] = $value['mm_years_with_current_carrier'];
  // Plan Year to Quote.
  $mps = 'field_mm_plan_start';
  $node->$mps[$lang][0][$val] = $value['mm_plan_year_to_quote_start'];
  $mpe = 'field_mm_plan_end';
  $node->$mpe[$lang][0][$val] = $value['mm_plan_year_to_quote_end'];
  // Is this a renewal of a current plan in BullsEye?
  $mber = 'field_mm_renewal_current_plan_be';
  $node->$mber[$lang][0][$val] = $value['mm_renewal_of_current_plan'];
  // Percentage of Employer Contribution.
  $mcs = 'field_mm_contrib_single';
  $node->$mcs[$lang][0][$val] = $value['mm_percentage_single'];
  $mcf = 'field_mm_contrib_family';
  $node->$mcf[$lang][0][$val] = $value['mm_percentage_family'];
  // Waiting Period for New Employees?
  $mwp = 'field_mm_waiting_period';
  $node->$mwp[$lang][0][$val] = $value['mm_waiting_period'];

  // Limited Medical.
  // Current Carrier.
  $lcc = 'field_lm_current_carrier';
  $node->$lcc[$lang][0][$val] = $value['lm_current_carrier'];
  // Years with current carrier.
  $lycc = 'field_lm_years_current_carrier';
  $node->$lycc[$lang][0][$val] = $value['lm_years_with_current_carrier'];
  // Plan Year to Quote.
  $lps = 'field_lm_plan_start';
  $node->$lps[$lang][0][$val] = $value['lm_plan_year_to_quote_start'];
  $lpe = 'field_lm_plan_end';
  $node->$lpe[$lang][0][$val] = $value['lm_plan_year_to_quote_end'];
  // Is this a renewal of a current plan in BullsEye?
  $lber = 'field_lm_renewal_current_plan_be';
  $node->$lber[$lang][0][$val] = $value['lm_renewal_of_current_plan'];
  // Percentage of Employer Contribution.
  $lcs = 'field_lm_contrib_single';
  $node->$lcs[$lang][0][$val] = $value['lm_percentage_single'];
  $lcf = 'field_lm_contrib_family';
  $node->$lcf[$lang][0][$val] = $value['lm_percentage_family'];
  // Waiting Period for New Employees?
  $lwp = 'field_lm_waiting_period';
  $node->$lwp[$lang][0][$val] = $value['lm_waiting_period'];

  // Teledoc.
  // Current Carrier.
  $tcc = 'field_tl_current_carrier';
  $node->$tcc[$lang][0][$val] = $value['tel_current_carrier'];
  // Years with current carrier.
  $tycc = 'field_tl_years_current_carrier';
  $node->$tycc[$lang][0][$val] = $value['tel_years_with_current_carrier'];
  // Plan Year to Quote.
  $lps = 'field_lm_plan_start';
  $node->$lps[$lang][0][$val] = $value['tel_plan_year_to_quote_start'];
  $lpe = 'field_lm_plan_end';
  $node->$lpe[$lang][0][$val] = $value['tel_plan_year_to_quote_end'];
  // Is this a renewal of a current plan in BullsEye?
  $lber = 'field_lm_renewal_current_plan_be';
  $node->$lber[$lang][0][$val] = $value['tel_renewal_of_current_plan'];
  // Percentage of Employer Contribution.
  $lcs = 'field_lm_contrib_single';
  $node->$lcs[$lang][0][$val] = $value['tel_percentage_single'];
  $lcf = 'field_lm_contrib_family';
  $node->$lcf[$lang][0][$val] = $value['tel_percentage_family'];
  // Waiting Period for New Employees?
  $lwp = 'field_lm_waiting_period';
  $node->$lwp[$lang][0][$val] = $value['tel_waiting_period'];


  // Save the carrier in the storage.
  $node = node_submit($node);
  node_save($node);

  drupal_set_message(t('Successfully added RFP.'));

  // Invalidate the existing cache to make sure that
  // the newly added one will get indexed too.
  cache_clear_all('rfp_listing', 'cache');
  // Reroute the page to the listing page.
  drupal_goto('/rfps');
}

/**
 * Implements hook_theme().
 */
function bullseye_rfp_theme($existing, $type, $theme, $path) {
  $items['benefit_pdf'] = array(
    'render element' => 'form',
    'template' => 'benefit-pdf',
    'path' => drupal_get_path('module', 'bullseye_rfp') . '/templates',
  );
  return $items;
}

/**
 * Generate the RFP PDF file.
 */
function bullseye_rfp_pdf_generate($benefit_title, $values, $form_values) {
  global $base_url;
  $theme_directory = path_to_theme('theme', 'bullseye');

  $vars = array();

  // Initialize variables placeholder.
  $vars['company'] = '';
  $vars['email'] = '';
  $vars['phone'] = '';
  $vars['website'] = '';
  $vars['address'] = '';

  if (isset($_SESSION['add_rfp'])) {
    $data = $_SESSION['add_rfp'];
    $account = node_load($data['account_id']);

    $vars['company'] = $account->field_company[LANGUAGE_NONE][0]['value'];
    $vars['email'] = $account->field_email[LANGUAGE_NONE][0]['value'];
    $vars['phone'] = $account->field_work_phone[LANGUAGE_NONE][0]['value'];
    $vars['website'] = $account->field_work_website[LANGUAGE_NONE][0]['value'];
    $street = $account->field_street[LANGUAGE_NONE][0]['value'];
    $city = $account->field_city[LANGUAGE_NONE][0]['value'];
    $state = $account->field_state_code[LANGUAGE_NONE][0]['value'];
    $code = $account->field_postal_code[LANGUAGE_NONE][0]['value'];
    $vars['address'] = $street . ', ' . $city . ', ' . $state . ' ' . $code;
  }

  $vars['benefit_name'] = $benefit_title;
  $vars['bootstrap_css'] = $base_url . '/' . $theme_directory . '/bootstrap/css/bootstrap.css';
  $vars['pdf_logo'] = $base_url . '/' . $theme_directory . '/images/archer-pdf-logo.png';

  $vars['fringe_rates'] = $form_values['fringe_rates'];
  $vars['proposed_effective_date'] = $form_values['proposed_effective_date'];
  $vars['other_work_locations'] = $form_values['other_work_locations'];
  $vars['number_of_employees'] = $form_values['number_of_employees'];
  $vars['number_of_dependents'] = $form_values['number_of_dependents'];
  $vars['nature_of_business'] = $form_values['nature_of_business'];
  $vars['years_in_business'] = $form_values['years_in_business'];
  $vars['tax_id'] = $form_values['tax_id'];
  $vars['renewal_date'] = $form_values['renewal_date'];

  $current_carrier = $values['current_carrier'] . ', ' . $values['years_with_current_carrier'];
  $plan_year_to_quote = $values['plan_year_to_quote_start'] . ' - ' . $values['plan_year_to_quote_end'];
  $vars['current_carrier'] = $current_carrier;
  $vars['plan_year_to_quote'] = $plan_year_to_quote;
  $vars['waiting_period'] = $values['waiting_period'];
  $vars['renewal'] = 'No';
  if ($values['renewal'] == 1) {
    $vars['renewal'] = 'Yes';
  }

  $html = theme('benefit_pdf', $vars);

  $filename = $benefit_title . ' - RFP.pdf';

  // Generate the PDF.
  $options = new Options();
  $options->set('isRemoteEnabled', TRUE);
  $dompdf = new Dompdf($options);
  $dompdf->loadHtml($html);
  $dompdf->setPaper('A4', 'portrait');
  $dompdf->render();
  $dompdf->stream($filename);

  // Saving pdf to server.
  /*$output = $dompdf->output();
  $dest = "/your-directory/final_file.pdf";
  $result = file_put_contents($dest, $output); */

}

/**
 * Submit handler for generate_rfp_major_medical.
 */
function generate_rfp_major_medical($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['mm_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['mm_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['mm_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['mm_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['mm_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['mm_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Major Medical', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);

}

/**
 * Submit handler for generate_rfp_limited_medical.
 */
function generate_rfp_limited_medical($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['lm_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['lm_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['lm_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['lm_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['lm_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['lm_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Limited Medical', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_teledoc.
 */
function generate_rfp_teledoc($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['tel_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['tel_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['tel_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['tel_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['tel_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['tel_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Telemedicine', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_mec.
 */
function generate_rfp_mec($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['mec_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['mec_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['mec_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['mec_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['mec_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['mec_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('MEC', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_dental.
 */
function generate_rfp_dental($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['den_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['den_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['den_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['den_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['den_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['den_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Dental', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_vision.
 */
function generate_rfp_vision($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['vs_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['vs_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['vs_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['vs_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['vs_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['vs_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Vision', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_life.
 */
function generate_rfp_life($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['lf_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['lf_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['lf_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['lf_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['lf_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['lf_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Life & AD&D', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_short_term_disability.
 */
function generate_rfp_short_term_disability($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['std_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['std_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['std_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['std_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['std_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['std_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Short Term Disability', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_retirement.
 */
function generate_rfp_retirement($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['ret_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['ret_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['ret_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['ret_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['ret_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['ret_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Retirement', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}

/**
 * Submit handler for generate_rfp_special_benefits.
 */
function generate_rfp_special_benefits($form, &$form_state) {
  global $user;

  $form_state['rebuild'] = TRUE;
  $values = array();
  $values['current_carrier'] = $form_state['values']['sb_current_carrier'];
  $values['years_with_current_carrier'] = $form_state['values']['sb_years_with_current_carrier'];
  $values['plan_year_to_quote_start'] = $form_state['values']['sb_plan_year_to_quote_start'];
  $values['plan_year_to_quote_end'] = $form_state['values']['sb_plan_year_to_quote_end'];
  $values['renewal'] = $form_state['values']['sb_renewal_of_current_plan'];
  $values['waiting_period'] = $form_state['values']['sb_waiting_period'];

  // Generate pdf and down it.
  bullseye_rfp_pdf_generate('Special Benefits', $values, $form_state['values']);

  // Send the email.
  $be = new Bullseye($user);
  $be->emailRfp($from, $to, $subject, $body, $attachments);
}
